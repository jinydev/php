---
layout: default
title: PHP BOOK
subtitle: numphp

tree: /php
---

# 2.3 PHP 내장서버
---
> `넘버 PHP 1권` 보충정리 내용입니다. 원문은 도서를 참고해 주시길 바랍니다.

무엇을 배우든지 첫 번째로 개발환경을 설정하는 것은 초보자에게 매우 부담이 될 수 있습니다. 이 책에서는 빠르게 PHP를 습득하고 개발 테스트를 할 수 있도록 PHP 내장 서버를 이용합니다.  

PHP 5.4부터는 별도의 외부 웹 서버가 없어도 내장 웹 서버를 통해 실행할 수 있습니다. PHP는 대부분 웹 서버와 연동되어 브라우저를 통해 실행됩니다. 때문에 항상 PHP를 사용하기 위해서는 아파치나 엔진엑스(NGINX) 등의 웹 서버 프로그램이 필요했습니다.  

이제 PHP의 내장 서버를 이용하여 로컬 작업 등 간단한 스크립트나 테스트하는 데 유용할 것입니다.  
<br>

## 2.3.1 PHP 서버 실행
---
PHP 내장 서버를 실행하는 것은 매우 쉽습니다. php.net 공식 사이트에서 파일을 다운로드한 후에 압축 해제하면 해당 폴더 안에 ./bin 디렉터리가 같이 생성됩니다.

./bin 디렉터리에는 PHP 실행에 관련된 파일들을 포함하고 있습니다. php.exe 파일은 윈도우에서 PHP를 실행할 수 있는 실행 파일입니다.
./bin 디렉터리로 이동합니다. PHP 서버를 실행하기 위해서는 콘솔 터미널에서 아래 코드를 입력합니다.
```
php -S localhost:8000
```

|화면결과|
```
C:\php-7.1.4-Win32-VC14-x86>php -S localhost:8000
PHP 7.1.4 Development Server started at Sun Apr 30 14:02:40 2017
Listening on http://localhost:8000
Document root is C:\php-7.1.4-Win32-VC14-x86
Press Ctrl-C to quit.
```

로컬 서버를 실행한 후에 브라우저에서 http://localhost:8000으로 접속하면 됩니다. 이것은 서버 이름은 localhost, 포트는 8000번을 쓰겠다는 의미입니다. 여기서 내장 서버를 실행하는 옵션은 대문자로 -S 입니다. 대소문자를 구분해야 함을 주의해야 합니다.

테스트 후 로컬 서버를 끝내기 위해서는 <crtl> + <c>를 누르면 실행된 서버가 종료됩니다.

PHP 내장 서버는 실행 도중 발생하는 PHP 에러 메시지와 실행 결과 등을 화면에 출력합니다. 최근 실행한 파일과 오류들을 한눈에 확인할 수 있습니다.
<br>

## 2.3.2 로컬 서버 문서 위치
---
PHP 내장 로컬 서버의 기본적인 문서 위치는 현재의 작업 디렉터리입니다. php 실행 샘플로 index.php 파일 하나 생성해봅니다.

예제 파일은 vi 에디터 또는 컴퓨터에서 작성하면 됩니다. 내용은 다음과 같습니다.

예제 파일 index.php
```
<?php
    echo "PHP LocalServer Test";
    // phpinfo() 함수는 현재의 PHP 정보를 출력합니다.
    phpinfo();
?>
```

이렇게 작성한 파일을 콘솔상에서 실행할 수도 있습니다. PHP 실행 파일 명령어 다음에 실행하고자 하는 파일의 이름을 같이 입력하면 됩니다.

소스에 있는 phpinfo() 함수에 대한 설명은 다음 장에서 설명하도록 하겠습니다.
```
#] php index.php   ← 콘솔실행
```
위와 같이 명령을 작성하면 콘솔에서 바로 화면에 출력될 것입니다. 하지만 콘솔로 출력하여 내용을 확인하는 방법은 불편할 수 있습니다. PHP가 웹 개발에 최적화된 언어의 특성을 살려서 웹 브라우저를 통해 실행해 봅니다.

웹 브라우저로 확인을 하기 위해서는 미리 웹 서버 또는 PHP 내장 서버가 실행되어 있어야 합니다. 브라우저를 실행한 다음에 주소창에 다음과 같이 입력합니다.

http://localhost:8000

위 주소에 접속하면 다음과 같은 PHP 정보 페이지가 보일 것입니다. 웹 사이트 주소는 localhost이며, 포트는 8000번을 이용하라는 의미입니다. 그러면 저장된 index.php 파일이 실행되어 화면에 출력될 것입니다.

만일 PHP 내장 서버로 실행을 하고 있다면 내장 웹 서버의 문서 시작 위치를 -t 옵션으로 사용자 설정을 바꿀 수 있습니다.
```
C:\php-7.1.4-Win32-VC14-x86>php -S localhost:8000 -t ./jinyPHP
```
실행 옵션 -t는 이후에 문서 시작 root 폴더 주소 경로를 입력하면 내장 웹 서버의 시작 문서 위치의 경로가 수정됩니다.
<br>

## 2.3.3 개별 환경 설정
---
PHP언어는 php.ini의 환경 설정 파일에 영향을 받습니다. php.ini 파일은 PHP 실행에 공통적으로 적용되어 동작합니다. 하지만 로컬 실행 서버만 별도의 개별 사용자 환경 파일을 적용하고 싶다면 직접 개별 환경 옵션을 연결할 수 있습니다.
```
PHP -S localhost:8000 -c < app/env/php.ini
```
실행 옵션 -c 를 통해서 사용자가 지정한 php.ini 파일을 적용하여 내장 서버를 실행할 수 있습니다.
<br>

## 2.3.4 .htaccess
---
아파치 웹 서버와 달리 PHP 내장 서버는 .htaccess 설정을 지원하지 않습니다. 따라서 요즘 프레임워크에서 많이 사용하는 rewrite 등의 규칙을 적용하거나 설정 등을 할 수 없습니다.
<br>

## 2.3.5 내장 서버 체크
---
PHP가 내장 웹 서버로 동작을 하고 있는지 또는 아파치나 엔진엑스 등 다른 외장 웹 서버를 사용하고 있는지를 판별할 수 있습니다. 

PHP 코딩을 하면서 웹 서버에 따라서 동작을 달리 처리해야 하는 경우 매우 유용합니다. PHP는 이러한 PHP 내장 웹 서버의 환경을 감지할 수 있는 특수한 함수를 제공합니다.

php_sapi_name() 내장 함수는 PHP 내장 서버 에서 제공하는 특수한 문자열 “cli-server”를 반환합니다.

예제 파일 cli-server.php
```
<?php
    if( php_sapi_name() === "cli-server"){
        echo "내장 웹 서버 실행환경 입니다.";
    } else {
        echo "외장 웹 서버 실행환경 입니다.";
    }
?>
```

<br><br>