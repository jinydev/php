---
layout: default
title: PHP BOOK
subtitle: numphp

tree: /php
---

# 16.1 클로저란?

 

익명 함수와 클로저는 이론적으로 다르지만 PHP는 ‘익명 함수 = 클로저’로 두 개는 같은 의미로 보고 있습니다. Closure 클래스는 PHP의 익명 함수를 만들 때 사용되는 클래스입니다.

 

**클로저 클래스 구조**

 

클로저가 일반적인 함수와 다른 점은 **호출 실행 후 실행된 함수의 접근**이 가능한지 여부입니다. 일반적으로 함수가 호출되면 실행 제어점이 전달됨과 동시에 함수의 매개변수, 처리로직이 실행됩니다. 

 

또한 실행이 완료되면 실행 제어점이 호출한곳으로 다시 반환되고 함수와 관련된 모든 로컬변수의 값들은 자동 소멸하게 됩니다. 이러한 함수의 휘발성은프로그램 처리와 메모리의 관리를 효율적으로 하기 위한 처리 기술입니다.

 

클로저는 익명 함수 생성 시 자신 자체를 객체로캡슐화합니다. 함수의 호출이 종료된 후에도 함수의 상태 및 내부 변수들의 상태 값은 유지하게 합니다. static 상태 처리와 유사할 수 있습니다.

 

클로저를 사용하는 이유는 이러한 호출 전후에특정한 동작이나 값을 처리할 수 있기 때문입니다.

 

 

**16.7.2****클로저 실습******

 

PHP언어의 클로저 기능은 익명 함수와 비슷한 문법으로 사용합니다.

 

**예제파일: closure-01.php**

 

**결과**

hello jiny

 

위의 예제는 일반적인 익명 함수와 비슷합니다. 하지만 익명 함수를 변수($closure)에 대입할 때 클로저 클래스를통해 인스턴스를 생성, 객체화하여 변수를 객체화합니다.

 

실질적으로 클로저 클래스로 생성된 익명 함수변수는 클래스의 인스턴스입니다. 따라서 클래스처럼 $this를통해 클로저 내부에 접근하거나 매서드를 실행할 수 있습니다.

 

 

**16.7.3****클로저 호출******

 

클로저가 객체라고 하면 어떻게 실행이 될까요? 클래스의 인스턴스는 -> 기호를 통해 프로퍼티, 메서드를 호출합니다.

 

하지만 클로저의 호출은 일반적인 클래스 호출방식이 아니라 익명 함수를 호출하는 것처럼 $변수명() 형태로합니다.

** **

**|****문법|**

 

클로저는 클로저 클래스로 생성된 인스턴스명뒤에 함수 표시처럼 소괄호 “()”가 붙어서 호출하게 되면 특수 메서드인 __involke()를 호출하는 형태로 실행을 대체합니다.

 

클로저는 콜백 함수와 매서드 용도로 많이 사용합니다. 콜백 기능이 필요한 array_map(),preg_replace_callback() 함수들은 클로저 기능이 매우 유용할 수 있을 것입니다.

 

 

**16.7.4****클로저 상태 등록******

 

클로저를 사용하는 목적은 호출하는 익명 함수의상태를 감지하기 위해서입니다. 

클로저로 상태를 감지하기 위해서는 use 키워드를 이용하여 수동으로 감지하고자 하는 상태를 등록해야 합니다.

 

**예제파일 : closure-02.php**

 

**결과**

name = hojin , command = jiny

 

위의 예제를 보면 클로저를 리턴하는 함수를하나 선언합니다. 함수를 호출함으로써 $clousreTest 변수에는클로저 인스턴스를 받게 됩니다. 이때, 함수는 종료하지만 use 키워드로 입력받은 $name 매개변수를 계속 가지고 있습니다.

 

클로저 변수는 반환받은 익명 함수 값을 호출하게됩니다. 익명 함수는 이전에 계속 갖고 있는 $name 값과익명 함수의 인자 입력 값 두 개를 출력합니다.

 
